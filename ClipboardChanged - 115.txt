CreateMenuFromDB() {
    Global SQLiteDB, DBPath
    Global LocateMenuMap, LocateCreateTimeMenuMap, LocateAccessTimeMenuMap, LocateAccessCountMenuMap, LocateLineMenuMap, LocatePinnedMenuMap, LocateCommonMenuMap
    Global RecentClipboardItems
    
    LocateMenuMap := {}
    LocateCreateTimeMenuMap := {}
    LocateAccessTimeMenuMap := {}
    LocateAccessCountMenuMap := {}
    LocateLineMenuMap := {}
    LocatePinnedMenuMap := {}
    LocateCommonMenuMap := {}
    RecentClipboardItems := []
    
    if (SQLiteDB) {
        SQLiteDB.CloseDB()
    }
    
    SQLiteDB := New SQLiteDB()
    if (!SQLiteDB.OpenDB(DBPath)) {
        MsgBox, 16, é”™è¯¯, é”™è¯¯ IDï¼š5604676 æ•°æ®åº“æ‰“å¼€å¤±è´¥ï¼è·¯å¾„: %DBPath%
        return
    }
    
    CreateGlobalIDTableSQL := "CREATE TABLE IF NOT EXISTS Global_ID_counter ("
        . "ID INTEGER PRIMARY KEY AUTOINCREMENT, "
        . "dummy INTEGER);"
    if (!SQLiteDB.Exec(CreateGlobalIDTableSQL)) {
        ErrorMsg := SQLiteDB._ErrMsg()
        MsgBox, 16, é”™è¯¯, é”™è¯¯ IDï¼š5607219 åˆ›å»ºå…¨å±€ ID è®¡æ•°å™¨è¡¨å¤±è´¥: %ErrorMsg%
        return
    }
    
    Menu, AltA_Menu, Add
    Menu, AltA_Menu, DeleteAll
    
    Menu, LocateCreateTimeMenu, Add
    Menu, LocateCreateTimeMenu, DeleteAll
    
    Menu, LocateAccessTimeMenu, Add
    Menu, LocateAccessTimeMenu, DeleteAll
    
    Menu, LocateAccessCountMenu, Add
    Menu, LocateAccessCountMenu, DeleteAll
    
    Menu, LocateLineMenu, Add
    Menu, LocateLineMenu, DeleteAll
    
    Menu, LocatePinnedMenu, Add
    Menu, LocatePinnedMenu, DeleteAll
    
    Menu, LocateCommonMenu, Add
    Menu, LocateCommonMenu, DeleteAll
    
    Menu, RemoveMenu, Add
    Menu, RemoveMenu, DeleteAll
    
    Menu, RemoveByClassMenu, Add
    Menu, RemoveByClassMenu, DeleteAll
    
    Menu, SendPromptMenu, Add
    Menu, SendPromptMenu, DeleteAll
    
    Menu, AltA_Menu, Add, âŒ å–æ¶ˆæ“ä½œ ðŸ•’ è®¿é—®æ—¶é—´, Terminate
    Menu, AltA_Menu, Add
    
    ; å‰ªè´´æ¿éƒ¨åˆ†
    ClipboardSQL := "SELECT " . """" . "ID" . """" . ", " . """" . "é¢„è§ˆæ–‡æœ¬" . """" . ", " . """" . "åŽŸå§‹æ•°æ®" . """" . " FROM " . """" . "å‰ªè´´æ¿æ•°æ®" . """" . " ORDER BY " . """" . "è®¿é—®æ—¶é—´" . """" . " DESC LIMIT 1;"
    ClipboardResult := {}
    if (SQLiteDB.GetTable(ClipboardSQL, ClipboardResult) && ClipboardResult.RowCount > 0) {
        RecordID := ClipboardResult.Rows[1][1]
        FullPreviewText := ClipboardResult.Rows[1][2]
        OriginalData := ClipboardResult.Rows[1][3]
        
        ActualContent := RegExReplace(FullPreviewText, "\s*\(\d+\)$", "")
        ActualContent := Trim(ActualContent)
        
        if (ActualContent = "") {
            Loop, Parse, OriginalData, `n, `r
            {
                Line := Trim(A_LoopField)
                if (Line != "") {
                    ActualContent := Line
                    break
                }
            }
        }
        
        DisplayPreviewText := FullPreviewText
        if (StrLen(DisplayPreviewText) > 60) {
            DisplayPreviewText := SubStr(DisplayPreviewText, 1, 60) . "..."
        }
        
        DisplayPreviewText := StrReplace(DisplayPreviewText, "`n", " ")
        DisplayPreviewText := StrReplace(DisplayPreviewText, "`r", " ")
        DisplayPreviewText := StrReplace(DisplayPreviewText, "`t", " ")
        
        ; æ–°å¢žï¼šæ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨äºŽå®šä½è¡Œè¡¨ï¼ˆä»¥å®Œæ•´é¢„è§ˆæ–‡æœ¬ä¸ºåˆ¤å®šï¼‰
        CheckSQL := "SELECT ID FROM å®šä½è¡Œ WHERE é¢„è§ˆæ–‡æœ¬ = ? LIMIT 1;"
        CheckResult := {}
        Exists := false
        if (SQLiteDB.GetTable(CheckSQL, CheckResult, [FullPreviewText]) && CheckResult.RowCount >= 1) {
            Exists := true
        }
        
        if (Exists) {
            MenuText := "å†™å…¥å®šä½ â†’ " . DisplayPreviewText
        } else {
            MenuText := "å†™å…¥å®šä½ â†’ æ–° " . DisplayPreviewText
        }
        
        Menu, AltA_Menu, Add, %MenuText%, WriteClipboardHandler
        RecentClipboardItems.Push({display: DisplayPreviewText, full: FullPreviewText, actual: ActualContent, id: RecordID})
    } else {
        Menu, AltA_Menu, Add, å†™å…¥å®šä½, WriteClipboardHandler
    }
    
    Menu, AltA_Menu, Add
    
    ; æœ€è¿‘è®¿é—®
    RecentSQL := "SELECT ID, é¢„è§ˆæ–‡æœ¬ FROM å®šä½è¡Œ ORDER BY è®¿é—®æ—¶é—´ DESC LIMIT 15;"
    RecentResult := {}
    if (!SQLiteDB.GetTable(RecentSQL, RecentResult)) {
        MsgBox, 16, é”™è¯¯, é”™è¯¯ IDï¼š5611488 æŸ¥è¯¢æœ€è¿‘è®°å½•å¤±è´¥ï¼
        return
    }
    
    if (RecentResult.RowCount > 0) {
        Loop, % RecentResult.RowCount {
            RecordID := RecentResult.Rows[A_Index][1]
            PreviewText := RecentResult.Rows[A_Index][2]
            
            if (StrLen(PreviewText) > 60) {
                PreviewText := SubStr(PreviewText, 1, 60) . "..."
            }
            
            PreviewText := StrReplace(PreviewText, "`n", " ")
            PreviewText := StrReplace(PreviewText, "`r", " ")
            PreviewText := StrReplace(PreviewText, "`t", " ")
            
            Menu, AltA_Menu, Add, %PreviewText%, LocateLineHandler
            LocateMenuMap[PreviewText] := RecordID
            
            if (A_Index < RecentResult.RowCount) {
                Menu, AltA_Menu, Add
            }
        }
    } else {
        Menu, AltA_Menu, Add, (æ— è®°å½•), DoNothing
        Menu, AltA_Menu, Disable, (æ— è®°å½•)
    }
    
    Menu, AltA_Menu, Add
    
    ; ç½®é¡¶é€‰é¡¹ï¼šåªæ˜¾ç¤ºç½®é¡¶=1ï¼ŒæŒ‰è®¿é—®æ—¶é—´ DESC LIMIT 15
    PinnedSQL := "SELECT ID, é¢„è§ˆæ–‡æœ¬ FROM å®šä½è¡Œ WHERE ç½®é¡¶ = 1 ORDER BY è®¿é—®æ—¶é—´ DESC LIMIT 15;"
    PinnedResult := {}
    
    if (!SQLiteDB.GetTable(PinnedSQL, PinnedResult)) {
        ErrorMsg := SQLiteDB._ErrMsg()
        MsgBox, 16, é”™è¯¯, é”™è¯¯ IDï¼š1645936 æŸ¥è¯¢ç½®é¡¶è®°å½•å¤±è´¥: %ErrorMsg%
        Menu, LocatePinnedMenu, Add, (æŸ¥è¯¢å¤±è´¥), DoNothing
        Menu, LocatePinnedMenu, Disable, (æŸ¥è¯¢å¤±è´¥)
    } else if (PinnedResult.RowCount > 0) {
        Loop, % PinnedResult.RowCount {
            RecordID := PinnedResult.Rows[A_Index][1]
            PreviewText := PinnedResult.Rows[A_Index][2]
            
            if (StrLen(PreviewText) > 60) {
                PreviewText := SubStr(PreviewText, 1, 60) . "..."
            }
            
            PreviewText := StrReplace(PreviewText, "`n", " ")
            PreviewText := StrReplace(PreviewText, "`r", " ")
            PreviewText := StrReplace(PreviewText, "`t", " ")
            
            Menu, LocatePinnedMenu, Add, %PreviewText%, LocateLineHandler
            LocatePinnedMenuMap[PreviewText] := RecordID
            
            if (A_Index < PinnedResult.RowCount) {
                Menu, LocatePinnedMenu, Add
            }
        }
    } else {
        Menu, LocatePinnedMenu, Add, (æ— ç½®é¡¶è®°å½•), DoNothing
        Menu, LocatePinnedMenu, Disable, (æ— ç½®é¡¶è®°å½•)
    }
    
    ; æ”¶è—é€‰é¡¹ï¼šåªæ˜¾ç¤ºæ”¶è—=1ï¼ŒæŒ‰è®¿é—®æ—¶é—´ DESC LIMIT 15
    CommonSQL := "SELECT ID, é¢„è§ˆæ–‡æœ¬ FROM å®šä½è¡Œ WHERE æ”¶è— = 1 ORDER BY è®¿é—®æ—¶é—´ DESC LIMIT 15;"
    CommonResult := {}
    
    if (!SQLiteDB.GetTable(CommonSQL, CommonResult)) {
        ErrorMsg := SQLiteDB._ErrMsg()
        MsgBox, 16, é”™è¯¯, é”™è¯¯ IDï¼š1653825 æŸ¥è¯¢æ”¶è—è®°å½•å¤±è´¥: %ErrorMsg%
        Menu, LocateCommonMenu, Add, (æŸ¥è¯¢å¤±è´¥), DoNothing
        Menu, LocateCommonMenu, Disable, (æŸ¥è¯¢å¤±è´¥)
    } else if (CommonResult.RowCount > 0) {
        Loop, % CommonResult.RowCount {
            RecordID := CommonResult.Rows[A_Index][1]
            PreviewText := CommonResult.Rows[A_Index][2]
            
            if (StrLen(PreviewText) > 60) {
                PreviewText := SubStr(PreviewText, 1, 60) . "..."
            }
            
            PreviewText := StrReplace(PreviewText, "`n", " ")
            PreviewText := StrReplace(PreviewText, "`r", " ")
            PreviewText := StrReplace(PreviewText, "`t", " ")
            
            Menu, LocateCommonMenu, Add, %PreviewText%, LocateLineHandler
            LocateCommonMenuMap[PreviewText] := RecordID
            
            if (A_Index < CommonResult.RowCount) {
                Menu, LocateCommonMenu, Add
            }
        }
    } else {
        Menu, LocateCommonMenu, Add, (æ— æ”¶è—è®°å½•), DoNothing
        Menu, LocateCommonMenu, Disable, (æ— æ”¶è—è®°å½•)
    }
    
    ; åˆ›å»ºæ—¶é—´
    CreateTimeSQL := "SELECT ID, é¢„è§ˆæ–‡æœ¬ FROM å®šä½è¡Œ ORDER BY åˆ›å»ºæ—¶é—´ DESC LIMIT 15;"
    CreateTimeResult := {}
    if (SQLiteDB.GetTable(CreateTimeSQL, CreateTimeResult) && CreateTimeResult.RowCount > 0) {
        Loop, % CreateTimeResult.RowCount {
            RecordID := CreateTimeResult.Rows[A_Index][1]
            PreviewText := CreateTimeResult.Rows[A_Index][2]
            
            if (StrLen(PreviewText) > 60) {
                PreviewText := SubStr(PreviewText, 1, 60) . "..."
            }
            PreviewText := StrReplace(PreviewText, "`n", " ")
            PreviewText := StrReplace(PreviewText, "`r", " ")
            PreviewText := StrReplace(PreviewText, "`t", " ")
            
            Menu, LocateCreateTimeMenu, Add, %PreviewText%, LocateLineHandler
            LocateCreateTimeMenuMap[PreviewText] := RecordID
            
            if (A_Index < CreateTimeResult.RowCount) {
                Menu, LocateCreateTimeMenu, Add
            }
        }
    } else {
        Menu, LocateCreateTimeMenu, Add, (æ— è®°å½•), DoNothing
        Menu, LocateCreateTimeMenu, Disable, (æ— è®°å½•)
    }
    
    ; è®¿é—®æ—¶é—´
    AccessTimeSQL := "SELECT ID, é¢„è§ˆæ–‡æœ¬ FROM å®šä½è¡Œ ORDER BY è®¿é—®æ—¶é—´ DESC LIMIT 15;"
    AccessTimeResult := {}
    if (SQLiteDB.GetTable(AccessTimeSQL, AccessTimeResult) && AccessTimeResult.RowCount > 0) {
        Loop, % AccessTimeResult.RowCount {
            RecordID := AccessTimeResult.Rows[A_Index][1]
            PreviewText := AccessTimeResult.Rows[A_Index][2]
            
            if (StrLen(PreviewText) > 60) {
                PreviewText := SubStr(PreviewText, 1, 60) . "..."
            }
            PreviewText := StrReplace(PreviewText, "`n", " ")
            PreviewText := StrReplace(PreviewText, "`r", " ")
            PreviewText := StrReplace(PreviewText, "`t", " ")
            
            Menu, LocateAccessTimeMenu, Add, %PreviewText%, LocateLineHandler
            LocateAccessTimeMenuMap[PreviewText] := RecordID
            
            if (A_Index < AccessTimeResult.RowCount) {
                Menu, LocateAccessTimeMenu, Add
            }
        }
    } else {
        Menu, LocateAccessTimeMenu, Add, (æ— è®°å½•), DoNothing
        Menu, LocateAccessTimeMenu, Disable, (æ— è®°å½•)
    }
    
    ; è®¿é—®æ¬¡æ•°
    AccessCountSQL := "SELECT ID, é¢„è§ˆæ–‡æœ¬, è®¿é—®æ¬¡æ•° FROM å®šä½è¡Œ ORDER BY è®¿é—®æ¬¡æ•° DESC LIMIT 15;"
    AccessCountResult := {}
    if (SQLiteDB.GetTable(AccessCountSQL, AccessCountResult) && AccessCountResult.RowCount > 0) {
        Loop, % AccessCountResult.RowCount {
            RecordID := AccessCountResult.Rows[A_Index][1]
            PreviewText := AccessCountResult.Rows[A_Index][2]
            AccessCount := AccessCountResult.Rows[A_Index][3]
            
            if (StrLen(PreviewText) > 50) {
                PreviewText := SubStr(PreviewText, 1, 50) . "..."
            }
            PreviewText := StrReplace(PreviewText, "`n", " ")
            PreviewText := StrReplace(PreviewText, "`r", " ")
            PreviewText := StrReplace(PreviewText, "`t", " ")
            
            MenuText := "[" . AccessCount . "] " . PreviewText
            Menu, LocateAccessCountMenu, Add, %MenuText%, LocateLineHandler
            LocateAccessCountMenuMap[MenuText] := RecordID
            
            if (A_Index < AccessCountResult.RowCount) {
                Menu, LocateAccessCountMenu, Add
            }
        }
    } else {
        Menu, LocateAccessCountMenu, Add, (æ— è®°å½•), DoNothing
        Menu, LocateAccessCountMenu, Disable, (æ— è®°å½•)
    }
    
    ; å®šä½è¡Œæ›´å¤š
    LineSQL := "SELECT ID, é¢„è§ˆæ–‡æœ¬ FROM å®šä½è¡Œ ORDER BY é¢„è§ˆæ–‡æœ¬;"
    LineResult := {}
    if (!SQLiteDB.GetTable(LineSQL, LineResult)) {
        MsgBox, 16, é”™è¯¯, é”™è¯¯ IDï¼š5617037 æŸ¥è¯¢å®šä½è¡Œè®°å½•å¤±è´¥ï¼
        Menu, LocateLineMenu, Add, (æ— è®°å½•), DoNothing
        Menu, LocateLineMenu, Disable, (æ— è®°å½•)
    } else if (LineResult.RowCount > 0) {
        groupedOptions := {}
        Loop, % LineResult.RowCount {
            RecordID := LineResult.Rows[A_Index][1]
            PreviewText := LineResult.Rows[A_Index][2]
            
            if (PreviewText = "") {
                continue
            }
            
            firstChar := SubStr(PreviewText, 1, 1)
            if RegExMatch(firstChar, "[A-Za-z]") {
                group := Format("{:U}", firstChar)
            } else {
                group := "å…¶ä»–"
            }
            if (!groupedOptions.HasKey(group)) {
                groupedOptions[group] := []
            }
            groupedOptions[group].Push({id: RecordID, previewText: PreviewText})
        }
        
        for group, options in groupedOptions {
            SortOptions(options, "previewText")
        }
        
        groupCount := groupedOptions.Count()
        groupIndex := 0
        for group, options in groupedOptions {
            groupIndex++
            groupDisplay := group
            subMenuName := "SubMenu_" . group
            Menu, %subMenuName%, Add
            Menu, %subMenuName%, DeleteAll
            for index, option in options {
                RecordID := option.id
                PreviewText := option.previewText
                if (StrLen(PreviewText) > 60) {
                    PreviewText := SubStr(PreviewText, 1, 60) . "..."
                }
                PreviewText := StrReplace(PreviewText, "`n", " ")
                PreviewText := StrReplace(PreviewText, "`r", " ")
                PreviewText := StrReplace(PreviewText, "`t", " ")
                MenuText := RecordID . "   " . PreviewText
                Menu, %subMenuName%, Add, %MenuText%, LocateLineHandler
                LocateLineMenuMap[MenuText] := RecordID
                if (index < options.Length()) {
                    Menu, %subMenuName%, Add
                }
            }
            Menu, LocateLineMenu, Add, %groupDisplay%, :%subMenuName%
            if (groupIndex < groupCount) {
                Menu, LocateLineMenu, Add
            }
        }
    } else {
        Menu, LocateLineMenu, Add, (æ— è®°å½•), DoNothing
        Menu, LocateLineMenu, Disable, (æ— è®°å½•)
    }
    
    ; æŒ‚è½½å­èœå•
    Menu, AltA_Menu, Add, ðŸ“… åˆ›å»ºæ—¶é—´, :LocateCreateTimeMenu
    Menu, AltA_Menu, Add, ðŸ•’ è®¿é—®æ—¶é—´, :LocateAccessTimeMenu
    Menu, AltA_Menu, Add, ðŸ‘ï¸ è®¿é—®æ¬¡æ•°, :LocateAccessCountMenu
    Menu, AltA_Menu, Add, ðŸ“Œ ç½®é¡¶, :LocatePinnedMenu
    Menu, AltA_Menu, Add, â˜… æ”¶è—, :LocateCommonMenu
    Menu, AltA_Menu, Add, ðŸ”  å®šä½è¡Œ æ›´å¤š, :LocateLineMenu
    
    Menu, AltA_Menu, Show
    
    return
}
